
<!DOCTYPE html>
<html>
<head>
  <title>Game T√†i X·ªâu</title>
</head>
<body>
  <h2>Ch√†o {{ username }} - S·ªë d∆∞: {{ "{:,}".format(money) }} VNƒê</h2>
  <form method="post" action="/bet">
    <input type="number" name="amount" placeholder="S·ªë ti·ªÅn">
    <button name="choice" value="T√†i">ƒê·∫∑t T√†i</button>
    <button name="choice" value="X·ªâu">ƒê·∫∑t X·ªâu</button>
  </form>
  <h3>L·ªãch s·ª≠ k·∫øt qu·∫£:</h3>
  <ul>
    {% for r in results %}
      <li>{{ r.time }} - {{ r.result }}</li>
    {% endfor %}
  </ul>
  <h3>B·∫£ng x·∫øp h·∫°ng:</h3>
  <ol>
    {% for u, info in leaderboard %}
      <li>{{ u }} - {{ "{:,}".format(info.money) }} VNƒê</li>
    {% endfor %}
  </ol>
  <h3>Chat:</h3>
  <form method="post" action="/chat">
    <input name="message" placeholder="Nh·∫≠p tin nh·∫Øn">
    <button>G·ª≠i</button>
  </form>
  <ul id="chatbox"></ul>

  <audio autoplay loop id="bgmusic">
    <source src="{{ url_for('static', filename='music.mp3') }}" type="audio/mpeg">
  </audio>
  <button onclick="toggleMusic()">üîä T·∫Øt/B·∫≠t Nh·∫°c</button>

  <script>
    function toggleMusic() {
      var music = document.getElementById("bgmusic");
      if (music.paused) music.play();
      else music.pause();
    }
    function fetchChat() {
      fetch("/get_chat").then(res => res.json()).then(data => {
        const chatbox = document.getElementById("chatbox");
        chatbox.innerHTML = "";
        for (let item of data) {
          const li = document.createElement("li");
          li.textContent = item.user + ": " + item.msg;
          chatbox.appendChild(li);
        }
      });
    }
    setInterval(fetchChat, 2000);
    fetchChat();
  </script>
</body>
</html>
